@model CardCatalog.Models.Card

@{
    ViewBag.Title = string.Join(" / ", Model.NormalizedFaces);
    var ownerships = ViewBag.Ownerships as List<CardCatalog.Models.Ownership>;
}

<style>
    .card-face { display: table; }
    .card-face-image { display: table-cell; padding-right: 22px; }
    .card-face-image img { vertical-align: top; }
    .card-face-properties { display: table-cell; width: 315px; }
    dl p { margin: 0; line-height: normal; }
    dd { margin-bottom: 10px; }
    .card-face-text { margin: 0 0 5px 0; }
</style>

<h2>@ViewBag.Title</h2>

<dl>
    <dt>Expansion:</dt>
    <dd>@Model.Expansion</dd>

    <dt>Rarity:</dt>
    <dd>@Model.Rarity</dd>

    @{
        var cardNumbers =
            Model.NormalizedFaces
            .Where(f => f != null)
            .Select(f => f.CardNumber)
            .Where(n => n != null)
            .ToList();
    }
    @if (cardNumbers.Count > 0)
    {
        <dt>Card Number:</dt>
        <dd>@string.Join(", ", cardNumbers)</dd>
    }
</dl>

@foreach (var face in Model.NormalizedFaces.Where(f => f != null))
{
    <fieldset class="card-face">
        <legend class="card-face-name">@face.Name</legend>
        <figure class="card-face-image"><img src="http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=@(face.Id)&type=card" /></figure>
        <section class="card-face-properties">
            <dl>
                @if (face.ManaCost != null)
                {
                    <dt>Mana Cost:</dt>
                    <dd>@face.ManaCost</dd>
                }

                @if (face.Types != null)
                {
                    <dt>Types:</dt>
                    <dd>@face.Types</dd>
                }

                @if (face.CardText != null || face.FlavorText != null)
                {
                    <dt>Card Text:</dt>
                    <dd>
                        @if (face.CardText != null)
                        {
                            foreach (var line in face.CardText)
                            {
                                <p class="card-face-text">@line</p>
                            }
                        }

                        @if (face.FlavorText != null)
                        {
                            foreach (var line in face.FlavorText)
                            {
                                <p class="card-face-flavor-text"><em>@line</em></p>
                            }
                        }
                    </dd>
                }

                @if (face.Power != null)
                {
                    <dt>Combat:</dt>
                    <dd>@face.Power/@face.Toughness</dd>
                }

                @if (face.Hand != null)
                {
                    <dt>Modifiers:</dt>
                    <dd>Hand @face.Hand, Life @face.Life</dd>
                }

                @if (face.Loyalty != null)
                {
                    <dt>Loyalty:</dt>
                    <dd>@face.Loyalty</dd>
                }

                @if (face.Artist != null)
                {
                    <dt>Artist:</dt>
                    <dd>@face.Artist</dd>
                }
            </dl>
        </section>
    </fieldset>
}

<p>
Owned: @ownerships.Count

@using (Html.BeginForm("add", "card", new { id = Model.Id }))
{
    <input type="text" id="quantity" name="quantity" value="1" /> <button type="submit">Add</button>
}
</p>

<script>
    $(document).bind('keyup.a', function () {
        $("#quantity").focus().select(); return false;
    });
</script>